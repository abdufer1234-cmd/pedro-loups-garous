<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedro Loups Garous - Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ†</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <style>
        /* CSS Ø§Ù„Ù…Ø¹Ø¯Ù„ */
        :root {
            --primary-color: #6a1b9a;
            --secondary-color: #9c27b0;
            --text-color: #f5f5f5;
            --background-dark: #121212;
            --background-light: #1e1e1e;
            --danger-color: #e53935;
            --success-color: #43a047;
            --werewolf-color: #8e24aa;
            --villager-color: #4caf50;
            --neutral-color: #ff9800;
            --online-color: #00e676;
            --offline-color: #757575;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Tajawal', Arial, sans-serif;
            background-color: var(--background-dark);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background-color: var(--primary-color);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        header h1 {
            color: white;
            font-size: 1.8rem;
            margin: 0;
        }

        #game-container {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .screen {
            display: none;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }

        .screen.active {
            display: flex;
        }

        h1, h2, h3 {
            color: var(--secondary-color);
            text-align: center;
        }

        .player-card {
            background-color: var(--background-light);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border-left: 5px solid transparent;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .player-card.werewolf {
            border-left-color: var(--werewolf-color);
        }

        .player-card.villager {
            border-left-color: var(--villager-color);
        }

        .player-card.neutral {
            border-left-color: var(--neutral-color);
        }

        .player-card.dead {
            opacity: 0.5;
            text-decoration: line-through;
            background-color: #333;
        }

        .player-card .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-card .player-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .player-card .player-status.online {
            background-color: var(--online-color);
        }

        .player-card .player-status.offline {
            background-color: var(--offline-color);
        }

        .player-card .player-actions {
            display: flex;
            gap: 10px;
        }

        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
            min-width: 100px;
        }

        button:hover {
            background-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        button.danger {
            background-color: var(--danger-color);
        }

        button.success {
            background-color: var(--success-color);
        }

        #game-log {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #333;
            flex-shrink: 0;
        }

        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }

        .log-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .phase-indicator {
            text-align: center;
            padding: 10px;
            font-weight: bold;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .night-phase {
            background-color: #0a0a2a;
            border: 1px solid #3333aa;
            color: #aaaaff;
        }

        .day-phase {
            background-color: #2a2a0a;
            border: 1px solid #aaaa33;
            color: #ffffaa;
        }

        .role-info {
            background-color: var(--background-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .role-info h3 {
            margin-top: 0;
            color: var(--text-color);
        }

        .settings-panel {
            background-color: var(--background-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            align-items: center;
        }

        select, input {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #333;
            color: white;
            font-family: inherit;
            min-width: 150px;
        }

        .hidden {
            display: none !important;
        }

        .player-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            flex: 1;
            overflow-y: auto;
            padding: 5px;
        }

        .action-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .vote-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .game-id-display {
            background-color: var(--background-light);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .copy-btn {
            background-color: transparent;
            border: 1px solid var(--secondary-color);
            padding: 2px 5px;
            font-size: 12px;
            margin-left: 5px;
        }

        .copy-btn:hover {
            background-color: var(--secondary-color);
        }

        .selected {
            background-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(106, 27, 154, 0.7);
        }

        footer {
            text-align: center;
            padding: 10px;
            background-color: var(--primary-color);
            color: white;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .player-list {
                grid-template-columns: 1fr;
            }
            
            .settings-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            header h1 {
                font-size: 1.4rem;
            }
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø­Ù„ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 480px) {
            button {
                padding: 8px 10px;
                min-width: 80px;
                font-size: 12px;
            }
            
            .player-card {
                padding: 10px;
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .player-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Pedro Loups Garous</h1>
    </header>

    <div id="game-container">
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="welcome-screen" class="screen active">
            <h2>Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ† Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</h2>
            <div class="settings-panel">
                <div class="settings-row">
                    <label for="player-name">Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨:</label>
                    <input type="text" id="player-name" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" maxlength="20">
                </div>
                <div class="settings-row">
                    <label for="game-mode">Ù†Ù…Ø· Ø§Ù„Ù„Ø¹Ø¨Ø©:</label>
                    <select id="game-mode">
                        <option value="classic">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ</option>
                        <option value="quick">Ø³Ø±ÙŠØ¹</option>
                        <option value="custom">Ù…Ø®ØµØµ</option>
                    </select>
                </div>
                <div class="settings-row">
                    <label for="player-count">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:</label>
                    <input type="number" id="player-count" min="5" max="20" value="8">
                </div>
            </div>
            <div class="action-panel">
                <button id="create-game">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
                <button id="join-game">Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ©</button>
            </div>
            <div id="join-section" class="hidden" style="margin-top: 20px;">
                <div class="settings-row">
                    <label for="game-id">Ù…Ø¹Ø±Ù Ø§Ù„ØºØ±ÙØ©:</label>
                    <input type="text" id="game-id" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„ØºØ±ÙØ©">
                </div>
                <button id="confirm-join">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</button>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØºØ±ÙØ© -->
        <div id="lobby-screen" class="screen">
            <h2>ØºØ±ÙØ© Ø§Ù„Ù„Ø¹Ø¨</h2>
            <div id="game-id-display" class="game-id-display hidden">
                Ù…Ø¹Ø±Ù Ø§Ù„ØºØ±ÙØ©: <span id="game-id-text"></span>
                <button class="copy-btn" onclick="copyGameId()">Ù†Ø³Ø®</button>
            </div>
            <div class="role-info hidden" id="lobby-role-info">
                <h3>Ø¯ÙˆØ±Ùƒ: <span id="lobby-role-name"></span></h3>
                <p id="lobby-role-desc"></p>
            </div>
            <div class="player-list" id="players-list"></div>
            <div class="action-panel">
                <button id="start-game" disabled>Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
                <button id="leave-lobby">Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØºØ±ÙØ©</button>
            </div>
        </div>

        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div id="game-screen" class="screen">
            <div class="phase-indicator night-phase hidden" id="night-indicator">
                <h2>ÙˆÙ‚Øª Ø§Ù„Ù„ÙŠÙ„ - Ø§Ù„ÙŠÙˆÙ… <span id="day-number">0</span></h2>
            </div>
            <div class="phase-indicator day-phase hidden" id="day-indicator">
                <h2>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§Ø± - Ø§Ù„ÙŠÙˆÙ… <span id="day-number-day">0</span></h2>
            </div>

            <div class="role-info">
                <h3>Ø¯ÙˆØ±Ùƒ: <span id="current-role-name"></span></h3>
                <p id="current-role-desc"></p>
            </div>

            <div id="night-actions" class="hidden">
                <h3>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„ÙŠÙ„</h3>
                <div id="role-specific-actions"></div>
                <button id="submit-night-action" disabled>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</button>
            </div>

            <div id="day-actions" class="hidden">
                <h3>ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©</h3>
                <div id="discussion-area">
                    <p id="night-results"></p>
                    <p id="discussion-text">Ù†Ø§Ù‚Ø´ Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„ØªÙƒØªØ´Ù Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ†!</p>
                </div>
                <div class="vote-buttons" id="voting-buttons"></div>
                <button id="submit-vote" disabled>ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØµÙˆÙŠØª</button>
            </div>

            <div id="game-over-panel" class="hidden">
                <h2 id="game-result-title"></h2>
                <p id="game-result-desc"></p>
                <div id="winner-players"></div>
                <button id="return-to-lobby">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©</button>
            </div>
        </div>

        <!-- Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -->
        <div id="game-log">
            <h3>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
            <div id="log-entries"></div>
        </div>
    </div>

    <footer>
        Pedro Loups Garous - Ù„Ø¹Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ† Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Â© 2023
    </footer>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDEXAMPLEEXAMPLEEXAMPLEEXAMPLE",
            authDomain: "pedro-loups-garous.firebaseapp.com",
            databaseURL: "https://pedro-loups-garous.firebaseio.com",
            projectId: "pedro-loups-garous",
            storageBucket: "pedro-loups-garous.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:EXAMPLEEXAMPLEEXAMPLE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        document.addEventListener('DOMContentLoaded', () => {
            // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            const welcomeScreen = document.getElementById('welcome-screen');
            const lobbyScreen = document.getElementById('lobby-screen');
            const gameScreen = document.getElementById('game-screen');
            
            // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„ÙˆØ¨ÙŠ
            const playerNameInput = document.getElementById('player-name');
            const gameModeSelect = document.getElementById('game-mode');
            const playerCountInput = document.getElementById('player-count');
            const createGameBtn = document.getElementById('create-game');
            const joinGameBtn = document.getElementById('join-game');
            const joinSection = document.getElementById('join-section');
            const confirmJoinBtn = document.getElementById('confirm-join');
            const gameIdInput = document.getElementById('game-id');
            const playersList = document.getElementById('players-list');
            const startGameBtn = document.getElementById('start-game');
            const leaveLobbyBtn = document.getElementById('leave-lobby');
            const gameIdDisplay = document.getElementById('game-id-display');
            const gameIdText = document.getElementById('game-id-text');
            
            // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„Ø¹Ø¨Ø©
            const nightIndicator = document.getElementById('night-indicator');
            const dayIndicator = document.getElementById('day-indicator');
            const currentRoleName = document.getElementById('current-role-name');
            const currentRoleDesc = document.getElementById('current-role-desc');
            const nightActions = document.getElementById('night-actions');
            const roleSpecificActions = document.getElementById('role-specific-actions');
            const submitNightAction = document.getElementById('submit-night-action');
            const dayActions = document.getElementById('day-actions');
            const nightResults = document.getElementById('night-results');
            const discussionText = document.getElementById('discussion-text');
            const votingButtons = document.getElementById('voting-buttons');
            const submitVote = document.getElementById('submit-vote');
            const gameOverPanel = document.getElementById('game-over-panel');
            const gameResultTitle = document.getElementById('game-result-title');
            const gameResultDesc = document.getElementById('game-result-desc');
            const winnerPlayers = document.getElementById('winner-players');
            const returnToLobbyBtn = document.getElementById('return-to-lobby');
            
            // Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            const logEntries = document.getElementById('log-entries');
            
            // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            const gameState = {
                players: [],
                currentPlayer: null,
                gameStarted: false,
                currentPhase: 'lobby',
                dayNumber: 0,
                currentRole: null,
                gameMode: 'classic',
                playerCount: 8,
                isHost: false,
                selectedPlayer: null,
                voteTarget: null,
                gameLog: [],
                gameId: null,
                gameRef: null,
                playerRef: null,
                roleActions: {},
                votes: {},
                lovers: []
            };
            
            // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
            const roles = {
                werewolf: {
                    name: 'Ù…Ø³ØªØ°Ø¦Ø¨',
                    team: 'werewolves',
                    description: 'ØªÙ‚ØªÙ„ Ù„ÙŠÙ„Ø§Ù‹ ÙˆØªØ­Ø§ÙˆÙ„ Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ù…Ø®ÙÙŠØ© Ù†Ù‡Ø§Ø±Ø§Ù‹. Ù‡Ø¯ÙÙƒ Ø§Ù„Ù‚Ø¶Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±ÙˆÙŠÙŠÙ†.',
                    nightAction: 'Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ø§Ù‹ Ù„Ù‚ØªÙ„Ù‡ Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø©',
                    priority: 2,
                    emoji: 'ğŸº'
                },
                villager: {
                    name: 'Ù‚Ø±ÙˆÙŠ',
                    team: 'villagers',
                    description: 'Ù„Ø§ ØªÙ…Ù„Ùƒ Ù‚Ø¯Ø±Ø§Øª Ø®Ø§ØµØ©. Ù‡Ø¯ÙÙƒ Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ† ÙˆØ¥Ø¹Ø¯Ø§Ù…Ù‡Ù….',
                    priority: 0,
                    emoji: 'ğŸ˜ï¸'
                },
                seer: {
                    name: 'Ø¹Ø±Ø§Ù',
                    team: 'villagers',
                    description: 'ØªØ³ØªØ·ÙŠØ¹ ÙƒØ´Ù Ù‡ÙˆÙŠØ© Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ ÙƒÙ„ Ù„ÙŠÙ„Ø©. Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¨Ø­ÙƒÙ…Ø©.',
                    nightAction: 'Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ø§Ù‹ Ù„Ù…Ø¹Ø±ÙØ© Ù‡ÙˆÙŠØªÙ‡',
                    priority: 3,
                    emoji: 'ğŸ”®'
                },
                witch: {
                    name: 'Ø³Ø§Ø­Ø±Ø©',
                    team: 'villagers',
                    description: 'ØªÙ…Ù„Ùƒ Ø¬Ø±Ø¹Ø© Ø¥Ù†Ù‚Ø§Ø° ÙˆØ¬Ø±Ø¹Ø© Ù‚ØªÙ„. ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„ Ù…Ù†Ù‡Ù…Ø§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©.',
                    nightAction: 'Ø§Ø®ØªØ± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†Ù‚Ø§Ø° Ø£Ùˆ Ø§Ù„Ù‚ØªÙ„',
                    priority: 4,
                    emoji: 'ğŸ§™'
                },
                hunter: {
                    name: 'ØµÙŠØ§Ø¯',
                    team: 'villagers',
                    description: 'Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¹Ø¯Ø§Ù…ÙƒØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ù‚ØªÙ„ Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø± Ù‚Ø¨Ù„ Ù…ØºØ§Ø¯Ø±ØªÙƒ.',
                    priority: 0,
                    emoji: 'ğŸ¹'
                },
                cupid: {
                    name: 'ÙƒÙŠÙˆØ¨ÙŠØ¯',
                    team: 'neutral',
                    description: 'ÙÙŠ Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ ØªØ±Ø¨Ø· Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø§Ù„Ø­Ø¨. Ø¥Ø°Ø§ Ù…Ø§Øª Ø£Ø­Ø¯Ù‡Ù…Ø§ØŒ ÙŠÙ…ÙˆØª Ø§Ù„Ø¢Ø®Ø±.',
                    nightAction: 'Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø±Ø¨Ø·Ù‡Ù…Ø§ Ø¨Ø§Ù„Ø­Ø¨',
                    priority: 1,
                    emoji: 'ğŸ’˜'
                },
                little_girl: {
                    name: 'Ø§Ù„Ø·ÙÙ„Ø© Ø§Ù„ØµØºÙŠØ±Ø©',
                    team: 'villagers',
                    description: 'ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ† Ù„ÙŠÙ„Ø§Ù‹ØŒ Ù„ÙƒÙ† Ø¥Ø°Ø§ Ø§ÙƒØªØ´ÙÙˆÙƒØŒ Ø³ÙˆÙ ÙŠÙ‚ØªÙ„ÙˆÙ†Ùƒ!',
                    priority: 0,
                    emoji: 'ğŸ‘§'
                },
                white_werewolf: {
                    name: 'Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ Ø§Ù„Ø£Ø¨ÙŠØ¶',
                    team: 'werewolves',
                    description: 'Ù‡Ø¯ÙÙƒ Ø£Ù† ØªÙƒÙˆÙ† Ø¢Ø®Ø± Ù†Ø§Ø¬Ù ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŒ Ø­ØªÙ‰ Ù„Ùˆ Ø§Ø¶Ø·Ø±Ø±Øª Ù„Ù‚ØªÙ„ Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.',
                    nightAction: 'Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ø§Ù‹ Ù„Ù‚ØªÙ„Ù‡ Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø©',
                    priority: 2,
                    emoji: 'ğŸºâ„ï¸'
                }
            };
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            initEvents();
            
            function initEvents() {
                // Ø£Ø­Ø¯Ø§Ø« Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                createGameBtn.addEventListener('click', createGame);
                joinGameBtn.addEventListener('click', () => {
                    joinSection.classList.toggle('hidden');
                });
                confirmJoinBtn.addEventListener('click', joinGame);
                
                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„ÙˆØ¨ÙŠ
                startGameBtn.addEventListener('click', startGame);
                leaveLobbyBtn.addEventListener('click', leaveLobby);
                
                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ø¹Ø¨Ø©
                submitNightAction.addEventListener('click', submitNightActionHandler);
                submitVote.addEventListener('click', submitVoteHandler);
                returnToLobbyBtn.addEventListener('click', returnToLobby);
                
                // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©
                playerCountInput.addEventListener('change', updateGameSettings);
            }
            
            function createGame() {
                const playerName = playerNameInput.value.trim();
                if (!playerName) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨');
                    return;
                }
                
                gameState.currentPlayer = {
                    id: generateId(),
                    name: playerName,
                    role: null,
                    isAlive: true,
                    isHost: true,
                    isOnline: true
                };
                
                gameState.gameMode = gameModeSelect.value;
                gameState.playerCount = parseInt(playerCountInput.value);
                gameState.isHost = true;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø¹Ø¨Ø©
                gameState.gameId = generateGameId();
                gameState.gameRef = database.ref('games/' + gameState.gameId);
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
                const gameData = {
                    settings: {
                        mode: gameState.gameMode,
                        maxPlayers: gameState.playerCount,
                        status: 'waiting',
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    },
                    players: {
                        [gameState.currentPlayer.id]: {
                            name: gameState.currentPlayer.name,
                            isHost: true,
                            isOnline: true,
                            ready: false
                        }
                    }
                };
                
                // Ø­ÙØ¸ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                gameState.gameRef.set(gameData)
                    .then(() => {
                        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ù…Ø¶ÙŠÙ
                        gameState.players = [gameState.currentPlayer];
                        
                        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        updatePlayersList();
                        welcomeScreen.classList.remove('active');
                        lobbyScreen.classList.add('active');
                        
                        // Ø¹Ø±Ø¶ Ù…Ø¹Ø±Ù Ø§Ù„ØºØ±ÙØ©
                        gameIdDisplay.classList.remove('hidden');
                        gameIdText.textContent = gameState.gameId;
                        
                        // ØªÙ…ÙƒÙŠÙ† Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ù„Ù„Ù…Ø¶ÙŠÙ
                        startGameBtn.disabled = gameState.players.length < 5;
                        
                        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©
                        setupGameListeners();
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
                        addLogEntry(`Ø£Ù†Ø´Ø£Øª ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© (${gameState.gameMode})`);
                    })
                    .catch(error => {
                        console.error('Error creating game:', error);
                        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                    });
            }
            
            function joinGame() {
                const playerName = playerNameInput.value.trim();
                const gameId = gameIdInput.value.trim();
                
                if (!playerName) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨');
                    return;
                }
                
                if (!gameId) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„ØºØ±ÙØ©');
                    return;
                }
                
                gameState.currentPlayer = {
                    id: generateId(),
                    name: playerName,
                    role: null,
                    isAlive: true,
                    isHost: false,
                    isOnline: true
                };
                
                gameState.gameId = gameId;
                gameState.gameRef = database.ref('games/' + gameState.gameId);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
                gameState.gameRef.once('value')
                    .then(snapshot => {
                        if (!snapshot.exists()) {
                            throw new Error('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
                        }
                        
                        const gameData = snapshot.val();
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ØºØ±ÙØ© Ù„Ø§ ØªØ²Ø§Ù„ ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
                        if (gameData.settings.status !== 'waiting') {
                            throw new Error('Ø§Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø¯ Ø¨Ø¯Ø£Øª Ø¨Ø§Ù„ÙØ¹Ù„');
                        }
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ù‡Ù†Ø§Ùƒ Ù…ÙƒØ§Ù†Ù‹Ø§ Ù„Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯
                        const playerCount = Object.keys(gameData.players || {}).length;
                        if (playerCount >= gameData.settings.maxPlayers) {
                            throw new Error('Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø©');
                        }
                        
                        // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©
                        return gameState.gameRef.child('players/' + gameState.currentPlayer.id).set({
                            name: gameState.currentPlayer.name,
                            isHost: false,
                            isOnline: true,
                            ready: false
                        });
                    })
                    .then(() => {
                        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                        welcomeScreen.classList.remove('active');
                        lobbyScreen.classList.add('active');
                        
                        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©
                        setupGameListeners();
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
                        addLogEntry(`Ø§Ù†Ø¶Ù…Ù…Øª Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ© ÙƒÙ€ ${playerName}`);
                    })
                    .catch(error => {
                        console.error('Error joining game:', error);
                        alert(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                    });
            }
            
            function setupGameListeners() {
                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„Ù‰ ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                gameState.gameRef.child('players').on('value', snapshot => {
                    const playersData = snapshot.val() || {};
                    gameState.players = Object.keys(playersData).map(playerId => {
                        return {
                            id: playerId,
                            name: playersData[playerId].name,
                            isHost: playersData[playerId].isHost,
                            isOnline: playersData[playerId].isOnline,
                            isAlive: true,
                            role: null
                        };
                    });
                    
                    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                    updatePlayersList();
                    
                    // Ø¥Ø°Ø§ ÙƒÙ†Øª Ø§Ù„Ù…Ø¶ÙŠÙØŒ ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙ…ÙƒÙ† Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                    if (gameState.currentPlayer.isHost) {
                        startGameBtn.disabled = gameState.players.length < 5;
                    }
                });
                
                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„Ù‰ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                gameState.gameRef.child('settings/status').on('value', snapshot => {
                    const status = snapshot.val();
                    
                    if (status === 'playing' && !gameState.gameStarted) {
                        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                        gameState.gameStarted = true;
                        lobbyScreen.classList.remove('active');
                        gameScreen.classList.add('active');
                        
                        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ù…ÙˆØ²Ø¹Ø©
                        gameState.gameRef.child('roles').once('value')
                            .then(rolesSnapshot => {
                                const rolesData = rolesSnapshot.val();
                                gameState.currentRole = rolesData[gameState.currentPlayer.id];
                                
                                // Ø¥Ø¸Ù‡Ø§Ø± Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
                                showPlayerRole();
                                
                                // Ø¨Ø¯Ø¡ Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
                                startNightPhase();
                                
                                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
                                addLogEntry('Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!');
                            });
                    }
                });
                
                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø¥Ù„Ù‰ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ø¹Ø¨Ø©
                gameState.gameRef.child('events').on('child_added', snapshot => {
                    const event = snapshot.val();
                    addLogEntry(event.message);
                    
                    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø®Ø§ØµØ©
                    if (event.type === 'game_over') {
                        endGame(event.data.title, event.data.message, event.data.winners);
                    }
                });
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ø§Ø¹Ø¨
                gameState.playerRef = gameState.gameRef.child('players/' + gameState.currentPlayer.id);
                updatePlayerOnlineStatus(true);
                
                // Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
                window.addEventListener('beforeunload', () => {
                    if (gameState.playerRef) {
                        updatePlayerOnlineStatus(false);
                    }
                });
            }
            
            function updatePlayerOnlineStatus(isOnline) {
                if (gameState.playerRef) {
                    gameState.playerRef.update({
                        isOnline: isOnline,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            }
            
            function startGame() {
                if (!gameState.isHost) return;
                
                // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
                const rolesPool = generateRolesPool();
                const rolesAssignment = {};
                
                gameState.players.forEach((player, index) => {
                    rolesAssignment[player.id] = rolesPool[index];
                });
                
                // Ø­ÙØ¸ Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                gameState.gameRef.update({
                    'roles': rolesAssignment,
                    'settings/status': 'playing',
                    'settings/startedAt': firebase.database.ServerValue.TIMESTAMP
                })
                .catch(error => {
                    console.error('Error starting game:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                });
            }
            
            function generateRolesPool() {
                let rolesPool = [];
                const playerCount = gameState.players.length;
                
                // ØªØ­Ø¯ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ† Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                const werewolfCount = Math.max(2, Math.floor(playerCount / 4));
                for (let i = 0; i < werewolfCount; i++) {
                    // 20% ÙØ±ØµØ© Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø³ØªØ°Ø¦Ø¨ Ø£Ø¨ÙŠØ¶ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø³ØªØ°Ø¦Ø¨ ÙˆØ§Ø­Ø¯
                    if (i === 0 && werewolfCount > 1 && Math.random() < 0.2) {
                        rolesPool.push('white_werewolf');
                    } else {
                        rolesPool.push('werewolf');
                    }
                }
                
                // Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø®Ø§ØµØ© Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                if (playerCount >= 5) {
                    rolesPool.push('seer');
                    rolesPool.push('witch');
                }
                
                if (playerCount >= 8) {
                    rolesPool.push('hunter');
                    rolesPool.push('cupid');
                }
                
                if (playerCount >= 10) {
                    rolesPool.push('little_girl');
                }
                
                // Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ù‚Ø±ÙˆÙŠÙŠÙ†
                while (rolesPool.length < playerCount) {
                    rolesPool.push('villager');
                }
                
                // Ø®Ù„Ø· Ø§Ù„Ø£Ø¯ÙˆØ§Ø±
                return shuffleArray(rolesPool);
            }
            
            function updatePlayersList() {
                playersList.innerHTML = '';
                gameState.players.forEach(player => {
                    const playerCard = document.createElement('div');
                    playerCard.className = `player-card ${player.role ? player.role.replace('_', '-') : ''} ${player.isAlive ? '' : 'dead'}`;
                    
                    const playerInfo = document.createElement('div');
                    playerInfo.className = 'player-info';
                    
                    const playerStatus = document.createElement('div');
                    playerStatus.className = `player-status ${player.isOnline ? 'online' : 'offline'}`;
                    playerInfo.appendChild(playerStatus);
                    
                    const playerName = document.createElement('span');
                    playerName.textContent = player.name + (player.isHost ? ' (Ù…Ø¶ÙŠÙ)' : '');
                    playerInfo.appendChild(playerName);
                    
                    if (player.role) {
                        const playerRole = document.createElement('div');
                        playerRole.textContent = roles[player.role].emoji;
                        playerRole.style.marginRight = '5px';
                        playerInfo.insertBefore(playerRole, playerInfo.firstChild);
                    }
                    
                    const playerActions = document.createElement('div');
                    playerActions.className = 'player-actions';
                    
                    // ÙÙŠ Ø§Ù„Ù„ÙˆØ¨ÙŠØŒ ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¶ÙŠÙ Ø·Ø±Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                    if (gameState.currentPlayer.isHost && !gameState.gameStarted && player.id !== gameState.currentPlayer.id) {
                        const kickBtn = document.createElement('button');
                        kickBtn.textContent = 'Ø·Ø±Ø¯';
                        kickBtn.className = 'danger';
                        kickBtn.addEventListener('click', () => kickPlayer(player.id));
                        playerActions.appendChild(kickBtn);
                    }
                    
                    playerCard.appendChild(playerInfo);
                    playerCard.appendChild(playerActions);
                    playersList.appendChild(playerCard);
                });
            }
            
            function kickPlayer(playerId) {
                if (!gameState.isHost) return;
                
                gameState.gameRef.child('players/' + playerId).remove()
                    .catch(error => {
                        console.error('Error kicking player:', error);
                        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø·Ø±Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                    });
            }
            
            function showPlayerRole() {
                const role = roles[gameState.currentRole];
                currentRoleName.textContent = role.name + ' ' + role.emoji;
                currentRoleDesc.textContent = role.description;
                
                // ÙÙŠ Ø§Ù„Ù„ÙˆØ¨ÙŠØŒ Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ù‚Ø¯ Ø¨Ø¯Ø£Øª
                const lobbyRoleInfo = document.getElementById('lobby-role-info');
                const lobbyRoleName = document.getElementById('lobby-role-name');
                const lobbyRoleDesc = document.getElementById('lobby-role-desc');
                
                lobbyRoleName.textContent = role.name + ' ' + role.emoji;
                lobbyRoleDesc.textContent = role.description;
                lobbyRoleInfo.classList.remove('hidden');
            }
            
            function startNightPhase() {
                gameState.currentPhase = 'night';
                gameState.dayNumber++;
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                nightIndicator.classList.remove('hidden');
                dayIndicator.classList.add('hidden');
                document.getElementById('day-number').textContent = gameState.dayNumber;
                document.getElementById('day-number-day').textContent = gameState.dayNumber;
                
                // Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø±
                dayActions.classList.add('hidden');
                
                // Ø¹Ø±Ø¶ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ù„Ø§Ø¹Ø¨ Ø¯ÙˆØ± Ù†Ø´Ø·
                if (roles[gameState.currentRole].nightAction) {
                    nightActions.classList.remove('hidden');
                    setupNightActions();
                } else {
                    nightActions.classList.add('hidden');
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
                addGameEvent(`Ø¨Ø¯Ø£Øª Ù„ÙŠÙ„Ø© Ø§Ù„ÙŠÙˆÙ… ${gameState.dayNumber}`);
                
                // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø§Ù†ØªØ¸Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø¥Ø¬Ø±Ø§Ø¡Ø§ØªÙ‡Ù…
            }
            
            function setupNightActions() {
                roleSpecificActions.innerHTML = '';
                
                const role = roles[gameState.currentRole];
                
                // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¯ÙˆØ±
                const actionTitle = document.createElement('h4');
                actionTitle.textContent = role.nightAction;
                roleSpecificActions.appendChild(actionTitle);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø°ÙŠÙ† ÙŠÙ…ÙƒÙ† Ø§Ø³ØªÙ‡Ø¯Ø§ÙÙ‡Ù…
                const alivePlayers = gameState.players.filter(p => p.isAlive && p.id !== gameState.currentPlayer.id);
                
                if (alivePlayers.length > 0) {
                    // Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
                    if (gameState.currentRole === 'cupid' && gameState.dayNumber === 1) {
                        // ÙƒÙŠÙˆØ¨ÙŠØ¯ ÙŠØ­ØªØ§Ø¬ Ù„Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ø«Ù†ÙŠÙ† ÙÙŠ Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
                        setupCupidAction(alivePlayers);
                    } else if (gameState.currentRole === 'witch') {
                        // Ø§Ù„Ø³Ø§Ø­Ø±Ø© ÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨ÙŠÙ† Ø§Ù„Ø¥Ù†Ù‚Ø§Ø° Ø£Ùˆ Ø§Ù„Ù‚ØªÙ„
                        setupWitchAction(alivePlayers);
                    } else {
                        // Ø§Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰ ØªØ®ØªØ§Ø± Ù„Ø§Ø¹Ø¨Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹
                        setupDefaultNightAction(alivePlayers);
                    }
                } else {
                    const noPlayersMsg = document.createElement('p');
                    noPlayersMsg.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø¢Ø®Ø±ÙˆÙ† Ø£Ø­ÙŠØ§Ø¡';
                    roleSpecificActions.appendChild(noPlayersMsg);
                    submitNightAction.disabled = true;
                }
            }
            
            function setupDefaultNightAction(alivePlayers) {
                const select = document.createElement('select');
                select.id = 'night-action-target';
                select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ø§Ù‹</option>';
                
                alivePlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.id;
                    option.textContent = player.name;
                    select.appendChild(option);
                });
                
                roleSpecificActions.appendChild(select);
                
                // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨
                select.addEventListener('change', (e) => {
                    gameState.selectedPlayer = e.target.value;
                    submitNightAction.disabled = !e.target.value;
                });
            }
            
            function setupCupidAction(alivePlayers) {
                const instruction = document.createElement('p');
                instruction.textContent = 'Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù„Ø±Ø¨Ø·Ù‡Ù…Ø§ Ø¨Ø§Ù„Ø­Ø¨:';
                roleSpecificActions.appendChild(instruction);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯Ø©
                const select = document.createElement('select');
                select.id = 'cupid-action-target';
                select.multiple = true;
                select.size = Math.min(5, alivePlayers.length);
                
                alivePlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.id;
                    option.textContent = player.name;
                    select.appendChild(option);
                });
                
                roleSpecificActions.appendChild(select);
                
                // ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯
                const helpText = document.createElement('small');
                helpText.textContent = '(Ø§Ø¶ØºØ· Ø²Ø± Ctrl Ù„Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ù„Ø§Ø¹Ø¨)';
                roleSpecificActions.appendChild(helpText);
                
                // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                select.addEventListener('change', (e) => {
                    const selectedOptions = Array.from(e.target.selectedOptions).map(opt => opt.value);
                    gameState.selectedPlayer = selectedOptions.length === 2 ? selectedOptions : null;
                    submitNightAction.disabled = selectedOptions.length !== 2;
                });
            }
            
            function setupWitchAction(alivePlayers) {
                // Ø§Ù„Ø³Ø§Ø­Ø±Ø© ÙŠÙ…ÙƒÙ†Ù‡Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†Ù‚Ø§Ø° Ø£Ùˆ Ø§Ù„Ù‚ØªÙ„ Ø£Ùˆ Ù„Ø§ Ø´ÙŠØ¡
                const choiceDiv = document.createElement('div');
                choiceDiv.style.display = 'flex';
                choiceDiv.style.flexDirection = 'column';
                choiceDiv.style.gap = '10px';
                
                // Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†Ù‚Ø§Ø°
                const saveDiv = document.createElement('div');
                saveDiv.style.display = 'flex';
                saveDiv.style.alignItems = 'center';
                saveDiv.style.gap = '10px';
                
                const saveCheckbox = document.createElement('input');
                saveCheckbox.type = 'checkbox';
                saveCheckbox.id = 'witch-save';
                saveDiv.appendChild(saveCheckbox);
                
                const saveLabel = document.createElement('label');
                saveLabel.htmlFor = 'witch-save';
                saveLabel.textContent = 'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†Ù‚Ø§Ø° Ø¹Ù„Ù‰:';
                saveDiv.appendChild(saveLabel);
                
                const saveSelect = document.createElement('select');
                saveSelect.id = 'witch-save-target';
                saveSelect.disabled = true;
                saveSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ø§Ù‹</option>';
                
                alivePlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.id;
                    option.textContent = player.name;
                    saveSelect.appendChild(option);
                });
                
                saveDiv.appendChild(saveSelect);
                choiceDiv.appendChild(saveDiv);
                
                // Ø¬Ø±Ø¹Ø© Ø§Ù„Ù‚ØªÙ„
                const killDiv = document.createElement('div');
                killDiv.style.display = 'flex';
                killDiv.style.alignItems = 'center';
                killDiv.style.gap = '10px';
                
                const killCheckbox = document.createElement('input');
                killCheckbox.type = 'checkbox';
                killCheckbox.id = 'witch-kill';
                killDiv.appendChild(killCheckbox);
                
                const killLabel = document.createElement('label');
                killLabel.htmlFor = 'witch-kill';
                killLabel.textContent = 'Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ø±Ø¹Ø© Ø§Ù„Ù‚ØªÙ„ Ø¹Ù„Ù‰:';
                killDiv.appendChild(killLabel);
                
                const killSelect = document.createElement('select');
                killSelect.id = 'witch-kill-target';
                killSelect.disabled = true;
                killSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù„Ø§Ø¹Ø¨Ø§Ù‹</option>';
                
                alivePlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player.id;
                    option.textContent = player.name;
                    killSelect.appendChild(option);
                });
                
                killDiv.appendChild(killSelect);
                choiceDiv.appendChild(killDiv);
                
                roleSpecificActions.appendChild(choiceDiv);
                
                // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„
                saveCheckbox.addEventListener('change', (e) => {
                    saveSelect.disabled = !e.target.checked;
                    killCheckbox.disabled = e.target.checked;
                    killSelect.disabled = true;
                    updateWitchSubmitButton();
                });
                
                killCheckbox.addEventListener('change', (e) => {
                    killSelect.disabled = !e.target.checked;
                    saveCheckbox.disabled = e.target.checked;
                    saveSelect.disabled = true;
                    updateWitchSubmitButton();
                });
                
                saveSelect.addEventListener('change', updateWitchSubmitButton);
                killSelect.addEventListener('change', updateWitchSubmitButton);
                
                function updateWitchSubmitButton() {
                    const saveChecked = saveCheckbox.checked;
                    const killChecked = killCheckbox.checked;
                    
                    if (saveChecked) {
                        gameState.selectedPlayer = {
                            action: 'save',
                            target: saveSelect.value
                        };
                    } else if (killChecked) {
                        gameState.selectedPlayer = {
                            action: 'kill',
                            target: killSelect.value
                        };
                    } else {
                        gameState.selectedPlayer = {
                            action: 'none',
                            target: null
                        };
                    }
                    
                    submitNightAction.disabled = !(
                        (saveChecked && saveSelect.value) || 
                        (killChecked && killSelect.value) ||
                        (!saveChecked && !killChecked)
                    );
                }
            }
            
            function submitNightActionHandler() {
                if (!gameState.selectedPlayer) return;
                
                let actionMessage = '';
                let actionData = {};
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
                switch (gameState.currentRole) {
                    case 'werewolf':
                    case 'white_werewolf':
                        const targetPlayer = gameState.players.find(p => p.id === gameState.selectedPlayer);
                        actionMessage = `Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙˆÙ† Ù‚Ø±Ø±ÙˆØ§ Ù‚ØªÙ„ ${targetPlayer.name} Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø©`;
                        actionData = {
                            type: 'werewolf_kill',
                            target: gameState.selectedPlayer
                        };
                        break;
                        
                    case 'seer':
                        const seenPlayer = gameState.players.find(p => p.id === gameState.selectedPlayer);
                        actionMessage = `Ø§Ù„Ø¹Ø±Ø§Ù ÙƒØ´Ù Ù‡ÙˆÙŠØ© ${seenPlayer.name}`;
                        actionData = {
                            type: 'seer_reveal',
                            target: gameState.selectedPlayer,
                            role: seenPlayer.role
                        };
                        break;
                        
                    case 'witch':
                        if (gameState.selectedPlayer.action === 'save') {
                            const savedPlayer = gameState.players.find(p => p.id === gameState.selectedPlayer.target);
                            actionMessage = `Ø§Ù„Ø³Ø§Ø­Ø±Ø© Ø§Ø³ØªØ®Ø¯Ù…Øª Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¥Ù†Ù‚Ø§Ø° Ø¹Ù„Ù‰ ${savedPlayer.name}`;
                            actionData = {
                                type: 'witch_save',
                                target: gameState.selectedPlayer.target
                            };
                        } else if (gameState.selectedPlayer.action === 'kill') {
                            const killedPlayer = gameState.players.find(p => p.id === gameState.selectedPlayer.target);
                            actionMessage = `Ø§Ù„Ø³Ø§Ø­Ø±Ø© Ø§Ø³ØªØ®Ø¯Ù…Øª Ø¬Ø±Ø¹Ø© Ø§Ù„Ù‚ØªÙ„ Ø¹Ù„Ù‰ ${killedPlayer.name}`;
                            actionData = {
                                type: 'witch_kill',
                                target: gameState.selectedPlayer.target
                            };
                        } else {
                            actionMessage = 'Ø§Ù„Ø³Ø§Ø­Ø±Ø© Ø§Ø®ØªØ§Ø±Øª Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠ Ø¬Ø±Ø¹Ø© Ù‡Ø°Ù‡ Ø§Ù„Ù„ÙŠÙ„Ø©';
                            actionData = {
                                type: 'witch_none'
                            };
                        }
                        break;
                        
                    case 'cupid':
                        if (Array.isArray(gameState.selectedPlayer)) {
                            const lover1 = gameState.players.find(p => p.id === gameState.selectedPlayer[0]);
                            const lover2 = gameState.players.find(p => p.id === gameState.selectedPlayer[1]);
                            actionMessage = `ÙƒÙŠÙˆØ¨ÙŠØ¯ Ø±Ø¨Ø· Ø¨ÙŠÙ† ${lover1.name} Ùˆ${lover2.name} Ø¨Ø§Ù„Ø­Ø¨`;
                            actionData = {
                                type: 'cupid_lovers',
                                lovers: gameState.selectedPlayer
                            };
                        }
                        break;
                }
                
                // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (actionData.type) {
                    gameState.gameRef.child('actions/' + gameState.currentPlayer.id).set(actionData)
                        .then(() => {
                            addLogEntry(actionMessage);
                            
                            // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ù†Ø§ Ø³ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§Ø±
                            // Ù„ÙƒÙ† Ù„Ù„ØªØ¨Ø³ÙŠØ·ØŒ Ø³Ù†Ù†ØªÙ‚Ù„ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                            setTimeout(() => {
                                if (gameState.currentPlayer.isHost) {
                                    processNightActions();
                                }
                            }, 2000);
                        });
                }
            }
            
            function processNightActions() {
                // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„ÙŠÙ„ÙŠØ© ÙˆØªÙ†ÙÙŠØ°Ù‡Ø§
                gameState.gameRef.child('actions').once('value')
                    .then(snapshot => {
                        const actions = snapshot.val() || {};
                        const nightResults = {
                            killed: [],
                            saved: [],
                            revealed: [],
                            lovers: []
                        };
                        
                        // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„ Ø¥Ø¬Ø±Ø§Ø¡
                        Object.keys(actions).forEach(playerId => {
                            const action = actions[playerId];
                            
                            switch (action.type) {
                                case 'werewolf_kill':
                                    nightResults.killed.push(action.target);
                                    break;
                                    
                                case 'witch_save':
                                    nightResults.saved.push(action.target);
                                    break;
                                    
                                case 'witch_kill':
                                    nightResults.killed.push(action.target);
                                    break;
                                    
                                case 'seer_reveal':
                                    nightResults.revealed.push({
                                        player: action.target,
                                        role: action.role
                                    });
                                    break;
                                    
                                case 'cupid_lovers':
                                    nightResults.lovers = action.lovers;
                                    break;
                            }
                        });
                        
                        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                        // 1. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† ØªÙ… Ø¥Ù†Ù‚Ø§Ø°Ù‡Ù… Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚ØªÙ„Ù‰
                        const finalKilled = nightResults.killed.filter(target => 
                            !nightResults.saved.includes(target));
                        
                        // 2. ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                        const updates = {};
                        finalKilled.forEach(playerId => {
                            updates['players/' + playerId + '/isAlive'] = false;
                        });
                        
                        // 3. Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¹Ø´Ø§Ù‚ØŒ Ø­ÙØ¸Ù‡Ù…
                        if (nightResults.lovers.length === 2) {
                            updates['settings/lovers'] = nightResults.lovers;
                        }
                        
                        // 4. Ù…Ø³Ø­ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„ÙŠÙ„ÙŠØ© Ù„Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
                        updates['actions'] = null;
                        
                        // 5. Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø±
                        updates['settings/phase'] = 'day';
                        
                        // ØªÙ†ÙÙŠØ° Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                        return gameState.gameRef.update(updates);
                    })
                    .then(() => {
                        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¹Ù† Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„ÙŠÙ„
                        addGameEvent('Ø§Ù†ØªÙ‡Øª Ù„ÙŠÙ„Ø© Ø§Ù„ÙŠÙˆÙ… ' + gameState.dayNumber);
                        
                        // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø¥Ø¹Ù„Ø§Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¨Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§Ø±
                        startDayPhase();
                    });
            }
            
            function startDayPhase() {
                gameState.currentPhase = 'day';
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                nightIndicator.classList.add('hidden');
                dayIndicator.classList.remove('hidden');
                
                // Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„ÙŠÙ„
                nightActions.classList.add('hidden');
                
                // Ø¹Ø±Ø¶ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø±
                dayActions.classList.remove('hidden');
                
                // Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù„ÙŠÙ„
                showNightResults();
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØµÙˆÙŠØª
                setupVoting();
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
                addGameEvent(`Ø¨Ø¯Ø£ Ù†Ù‡Ø§Ø± Ø§Ù„ÙŠÙˆÙ… ${gameState.dayNumber}`);
            }
            
            function showNightResults() {
                // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³ØªØ£ØªÙŠ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                // Ù„ÙƒÙ†Ù†Ø§ Ø³Ù†Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ
                const randomEvents = [
                    'Ù„ÙŠÙ„Ø© Ù‡Ø§Ø¯Ø¦Ø© Ù…Ø±Øª Ø¯ÙˆÙ† Ø£Ø­Ø¯Ø§Ø«',
                    'Ø³Ù…Ø¹ Ø§Ù„Ù‚Ø±ÙˆÙŠÙˆÙ† ØµÙˆØª Ø¹ÙˆØ§Ø¡ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©',
                    `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${getRandomPlayerName()} Ù…Ù‚ØªÙˆÙ„Ø§Ù‹ ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­`,
                    'Ù„Ù… ØªØ­Ø¯Ø« Ø£ÙŠ Ø¬Ø±Ø§Ø¦Ù… Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©',
                    `ÙˆØ¬Ø¯ Ø§Ù„Ù‚Ø±ÙˆÙŠÙˆÙ† Ø¬Ø«Ø© ${getRandomPlayerName()} ÙÙŠ Ø§Ù„Ø³Ø§Ø­Ø©`
                ];
                
                const randomEvent = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                nightResults.textContent = randomEvent;
            }
            
            function setupVoting() {
                votingButtons.innerHTML = '';
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµÙˆÙŠØª Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø£Ø­ÙŠØ§Ø¡
                const alivePlayers = gameState.players.filter(p => p.isAlive && p.id !== gameState.currentPlayer.id);
                
                if (alivePlayers.length > 0) {
                    alivePlayers.forEach(player => {
                        const button = document.createElement('button');
                        button.textContent = player.name;
                        button.dataset.playerId = player.id;
                        
                        button.addEventListener('click', () => {
                            // Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ø£Ø²Ø±Ø§Ø± Ø£Ø®Ø±Ù‰
                            document.querySelectorAll('#voting-buttons button').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
                            button.classList.add('selected');
                            gameState.voteTarget = player.id;
                            submitVote.disabled = false;
                        });
                        
                        votingButtons.appendChild(button);
                    });
                } else {
                    const noPlayersMsg = document.createElement('p');
                    noPlayersMsg.textContent = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø¢Ø®Ø±ÙˆÙ† Ø£Ø­ÙŠØ§Ø¡ Ù„Ù„ØªØµÙˆÙŠØª Ø¶Ø¯Ù‡Ù…';
                    votingButtons.appendChild(noPlayersMsg);
                    submitVote.disabled = true;
                }
            }
            
            function submitVoteHandler() {
                if (!gameState.voteTarget) return;
                
                const targetPlayer = gameState.players.find(p => p.id === gameState.voteTarget);
                if (!targetPlayer) return;
                
                // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØµÙˆÙŠØª Ù„Ù„Ø®Ø§Ø¯Ù…
                addLogEntry(`ØµÙˆØªØª Ø¶Ø¯ ${targetPlayer.name}`);
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØµÙˆÙŠØª
                setTimeout(() => {
                    // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ø¹Ø¯ Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª
                    const isExecuted = Math.random() > 0.5;
                    
                    if (isExecuted) {
                        targetPlayer.isAlive = false;
                        addLogEntry(`ØªÙ… Ø¥Ø¹Ø¯Ø§Ù… ${targetPlayer.name} (ÙƒØ§Ù† ${roles[targetPlayer.role].name})`);
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙŠØ§Ø¯ØŒ ÙŠÙ†ÙØ° Ø¥Ø¬Ø±Ø§Ø¡Ù‡
                        if (targetPlayer.role === 'hunter') {
                            addLogEntry(`${targetPlayer.name} (Ø§Ù„ØµÙŠØ§Ø¯) ÙŠÙ‚ØªÙ„ Ù„Ø§Ø¹Ø¨Ø§Ù‹ Ø¢Ø®Ø± Ù‚Ø¨Ù„ Ù…ÙˆØªÙ‡!`);
                            // Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø± Ù„Ù„Ù‚ØªÙ„
                        }
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø´Ø±ÙˆØ· Ø§Ù„ÙÙˆØ²
                        checkWinConditions();
                    } else {
                        addLogEntry(`Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ù… ${targetPlayer.name}ØŒ Ø§Ù„Ø£ØµÙˆØ§Øª Ù„Ù… ØªÙƒÙ† ÙƒØ§ÙÙŠØ©`);
                    }
                    
                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠ
                    if (gameState.gameStarted) {
                        startNightPhase();
                    }
                }, 2000);
            }
            
            function checkWinConditions() {
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ† Ø§Ù„Ø£Ø­ÙŠØ§Ø¡
                const aliveWerewolves = gameState.players.filter(p => 
                    p.isAlive && (p.role === 'werewolf' || p.role === 'white_werewolf')).length;
                
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø±ÙˆÙŠÙŠÙ† Ø§Ù„Ø£Ø­ÙŠØ§Ø¡
                const aliveVillagers = gameState.players.filter(p => 
                    p.isAlive && p.role !== 'werewolf' && p.role !== 'white_werewolf').length;
                
                // Ø´Ø±ÙˆØ· Ø§Ù„ÙÙˆØ²
                if (aliveWerewolves === 0) {
                    endGame('ÙÙˆØ² Ø§Ù„Ù‚Ø±ÙˆÙŠÙŠÙ†', 'ØªÙ… Ø§Ù„Ù‚Ø¶Ø§Ø¡ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ†!', 
                           gameState.players.filter(p => p.role !== 'werewolf' && p.role !== 'white_werewolf'));
                } else if (aliveWerewolves >= aliveVillagers) {
                    endGame('ÙÙˆØ² Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙŠÙ†', 'Ø§Ù„Ù…Ø³ØªØ°Ø¦Ø¨ÙˆÙ† ØªÙÙˆÙ‚ÙˆØ§ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±ÙˆÙŠÙŠÙ†!', 
                           gameState.players.filter(p => p.role === 'werewolf' || p.role === 'white_werewolf'));
                }
                // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙˆØ· ÙÙˆØ² Ø£Ø®Ø±Ù‰ Ù„Ù„Ø£Ø¯ÙˆØ§Ø± Ø§Ù„Ø®Ø§ØµØ©
            }
            
            function endGame(title, message, winners) {
                gameState.gameStarted = false;
                
                // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                gameResultTitle.textContent = title;
                gameResultDesc.textContent = message;
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ†
                winnerPlayers.innerHTML = '';
                if (winners && winners.length > 0) {
                    const winnersTitle = document.createElement('h4');
                    winnersTitle.textContent = 'Ø§Ù„ÙØ§Ø¦Ø²ÙˆÙ†:';
                    winnerPlayers.appendChild(winnersTitle);
                    
                    const winnersList = document.createElement('div');
                    winnersList.className = 'player-list';
                    
                    winners.forEach(player => {
                        const playerCard = document.createElement('div');
                        playerCard.className = `player-card ${player.role ? player.role.replace('_', '-') : ''}`;
                        
                        const playerInfo = document.createElement('div');
                        playerInfo.className = 'player-info';
                        
                        const playerRole = document.createElement('div');
                        playerRole.textContent = roles[player.role].emoji;
                        playerInfo.appendChild(playerRole);
                        
                        const playerName = document.createElement('span');
                        playerName.textContent = player.name;
                        playerInfo.appendChild(playerName);
                        
                        playerCard.appendChild(playerInfo);
                        winnersList.appendChild(playerCard);
                    });
                    
                    winnerPlayers.appendChild(winnersList);
                }
                
                gameOverPanel.classList.remove('hidden');
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
                addGameEvent(`Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©: ${title} - ${message}`);
                
                // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ù†Ø§ Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (gameState.isHost) {
                    const gameOverEvent = {
                        type: 'game_over',
                        message: `Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©: ${title}`,
                        data: {
                            title: title,
                            message: message,
                            winners: winners.map(p => p.id)
                        },
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    gameState.gameRef.child('events').push(gameOverEvent);
                    gameState.gameRef.child('settings/status').set('finished');
                }
            }
            
            function returnToLobby() {
                gameOverPanel.classList.add('hidden');
                gameScreen.classList.remove('active');
                lobbyScreen.classList.add('active');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                resetGameState();
            }
            
            function leaveLobby() {
                // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (gameState.playerRef) {
                    gameState.playerRef.remove();
                }
                
                lobbyScreen.classList.remove('active');
                welcomeScreen.classList.add('active');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                resetGameState();
            }
            
            function resetGameState() {
                gameState.players = [];
                gameState.gameStarted = false;
                gameState.currentPhase = 'lobby';
                gameState.dayNumber = 0;
                gameState.currentRole = null;
                gameState.selectedPlayer = null;
                gameState.voteTarget = null;
                gameState.gameLog = [];
                
                if (gameState.gameRef) {
                    gameState.gameRef.off();
                    gameState.gameRef = null;
                }
                
                if (gameState.playerRef) {
                    gameState.playerRef.off();
                    gameState.playerRef = null;
                }
                
                // Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                logEntries.innerHTML = '';
            }
            
            function addLogEntry(message) {
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                logEntries.appendChild(entry);
                
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ø¹Ø±Ø¶ Ø£Ø­Ø¯Ø« Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
                logEntries.scrollTop = logEntries.scrollHeight;
                
                // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©
                gameState.gameLog.push(message);
            }
            
            function addGameEvent(message) {
                addLogEntry(message);
                
                // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒÙ†Øª Ø§Ù„Ù…Ø¶ÙŠÙ
                if (gameState.isHost) {
                    const event = {
                        type: 'game_event',
                        message: message,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    };
                    
                    gameState.gameRef.child('events').push(event);
                }
            }
            
            function getRandomPlayerName() {
                const alivePlayers = gameState.players.filter(p => p.isAlive);
                if (alivePlayers.length === 0) return 'Ù„Ø§Ø¹Ø¨';
                
                const randomPlayer = alivePlayers[Math.floor(Math.random() * alivePlayers.length)];
                return randomPlayer.name;
            }
            
            function copyGameId() {
                if (!gameState.gameId) return;
                
                navigator.clipboard.writeText(gameState.gameId)
                    .then(() => {
                        const copyBtn = document.querySelector('.copy-btn');
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
                        
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy game ID:', err);
                    });
            }
            
            function generateId() {
                return Math.random().toString(36).substr(2, 9);
            }
            
            function generateGameId() {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù ØºØ±ÙØ© Ø³Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
                const letters = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
                const numbers = '23456789';
                let id = '';
                
                for (let i = 0; i < 3; i++) {
                    id += letters.charAt(Math.floor(Math.random() * letters.length));
                }
                
                for (let i = 0; i < 3; i++) {
                    id += numbers.charAt(Math.floor(Math.random() * numbers.length));
                }
                
                return id;
            }
            
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
            
            function updateGameSettings() {
                const playerCount = parseInt(playerCountInput.value);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
                if (playerCount < 8) {
                    gameModeSelect.value = 'classic';
                }
            }
        });
    </script>
</body>
</html>